<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>R√©vision Verbes Irr√©guliers (NL).</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <style>
        .irregular-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .frequency-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-light-gray);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .filter-btn {
            padding: 12px 20px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95em;
            color: var(--text-dark);
        }

        .filter-btn:hover {
            border-color: var(--primary);
            background: var(--info);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .exercise-box {
            background: var(--bg-light-gray);
            padding: 30px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .verb-display {
            margin-bottom: 25px;
        }

        .infinitive-form {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auxiliary-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            cursor: default;
            pointer-events: none;
            border: 2px solid;
            white-space: nowrap;
        }

        .auxiliary-badge.hebben {
            background: #BFDBFE;
            border-color: #3B82F6;
            color: #1E40AF;
        }

        .auxiliary-badge.zijn {
            background: #BBEF63;
            border-color: #22C55E;
            color: #166534;
        }

        .auxiliary-badge.both {
            background: #FCD34D;
            border-color: #F59E0B;
            color: #92400E;
        }

        .translation {
            font-size: 1em;
            color: var(--text-medium);
            font-style: italic;
            margin-bottom: 20px;
        }

        .question-type {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding: 12px;
            background: white;
            border-left: 4px solid var(--secondary);
            border-radius: 4px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: 600;
            text-align: left;
            color: var(--text-dark);
        }

        .option-btn:hover {
            border-color: var(--primary);
            background: var(--info);
            transform: translateX(5px);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .option-btn.correct {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .option-btn.incorrect {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        .feedback.correct {
            background: #D1FAE5;
            color: #065F46;
            border-left: 4px solid var(--success);
            display: block;
        }

        .feedback.incorrect {
            background: #FEE2E2;
            color: #7F1D1D;
            border-left: 4px solid var(--accent);
            display: block;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
        }

        .score {
            text-align: center;
            padding: 15px;
            background: var(--info);
            border-radius: 8px;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .memory {
            background: #FEF3C7;
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #92400E;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary);
        }

        .filter-info {
            text-align: center;
            padding: 10px;
            background: var(--info);
            border-radius: 8px;
            color: var(--primary);
            font-weight: 600;
            margin-top: 15px;
        }

        .no-verbs-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-medium);
            background: var(--bg-light-gray);
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <h1>üìö FR/NL</h1>
            <div class="navbar-buttons">
                <a href="index.html" class="navbar-link">üè† Accueil</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-top: 0;">R√©vision des Verbes Irr√©guliers</h1>
        <p class="subtitle">Entra√Æne-toi √† reconna√Ætre les formes de l'imparfait (pass√© simple) des verbes irr√©guliers n√©erlandais !</p>

        <div class="memory">
            <strong>üìù Rappel :</strong> <br>
            L'<b>imparfait singulier</b> (ik/jij/hij/zij/u) et <b>pluriel</b> (wij/jullie/zij) sont importants √† m√©moriser pour les verbes irr√©guliers. Le <b>participe pass√©</b> est utilis√© avec "hebben" ou "zijn" pour former les temps compos√©s.
        </div>

        <h2 style="color: var(--primary); margin-top: 30px;">Choisir votre niveau</h2>
        <div class="frequency-filters">
            <button class="filter-btn active" onclick="changerFiltre('very_frequent')">
                ‚≠ê Tr√®s fr√©quent
            </button>
            <button class="filter-btn" onclick="changerFiltre('frequent')">
                ‚≠ê‚≠ê Fr√©quent
            </button>
            <button class="filter-btn" onclick="changerFiltre('all')">
                ‚≠ê‚≠ê‚≠ê Tous les verbes
            </button>
        </div>

        <div class="score">
            R√©ponses correctes : <span id="scoreValue">0</span> / <span id="totalValue">0</span>
        </div>

        <div class="exercise-box">
            <div class="verb-display">
                <div class="infinitive-form" id="infinitiveForm">Chargement...</div>
                <div class="translation" id="translation">Attente du chargement...</div>
            </div>

            <div class="question-type" id="questionType"></div>

            <div class="options" id="optionsContainer"></div>

            <div class="feedback" id="feedback"></div>

            <div class="button-group">
                <button class="btn btn-primary" id="validateBtn" onclick="validerReponse()" disabled>Valider</button>
                <button class="btn btn-secondary" id="nextBtn" onclick="nouvelleQuestion()" style="display: none;">Question suivante</button>
            </div>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Bonnes r√©ponses</div>
                    <div class="stat-value" id="correctCount">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Taux de r√©ussite</div>
                    <div class="stat-value" id="percentage">0%</div>
                </div>
            </div>

            <div class="filter-info" id="filterInfo"></div>
        </div>
    </div>

    <script>
        let verbes = [];
        let verbesFiltr√©s = [];
        let currentVerb = null;
        let currentQuestion = null;
        let selectedOption = null;
        let correctAnswer = null;
        let questionAnswered = false;
        let correctCount = 0;
        let totalCount = 0;
        let currentFrequency = 'very_frequent';
        const MAX_QUESTIONS = 10;

        function getAuxiliaryType(verb) {
            return verb.auxiliary || null;
        }

        function getAuxiliaryDisplay(auxiliaryType) {
            const displays = {
                'hebben': 'üîµ hebben',
                'zijn': 'üü¢ zijn',
                'both': 'üü° hebben of zijn'
            };
            return displays[auxiliaryType] || '';
        }

        function translateAuxiliary(participlePass√©, auxiliaryType) {
            if (!participlePass√©) return participlePass√©;
            
            const icon = auxiliaryType === 'hebben' ? 'üîµ' : 
                        auxiliaryType === 'zijn' ? 'üü¢' : 
                        auxiliaryType === 'both' ? 'üü°' : '';
            
            const auxiliary = auxiliaryType === 'hebben' ? 'hebben' :
                             auxiliaryType === 'zijn' ? 'zijn' :
                             auxiliaryType === 'both' ? 'hebben of zijn' : '';
            
            return icon + ' ' + auxiliary + ' ' + participlePass√©;
        }

        async function chargerVerbes() {
            try {
                const response = await fetch('irregulier.json?t=' + Date.now());
                if (!response.ok) {
                    throw new Error('Impossible de charger irregulier.json');
                }
                verbes = await response.json();
                console.log('Verbes charg√©s:', verbes.length);
                
                // Appliquer le filtre initial
                appliquerFiltre();
            } catch (e) {
                console.error('Erreur:', e);
                document.querySelector('.exercise-box').innerHTML = 
                    `<div style="color: red;"><strong>Erreur:</strong> ${e.message}</div>`;
            }
        }

        function appliquerFiltre() {
            if (currentFrequency === 'very_frequent') {
                verbesFiltr√©s = verbes.filter(v => v.frequency === 'very_frequent');
            } else if (currentFrequency === 'frequent') {
                verbesFiltr√©s = verbes.filter(v => v.frequency === 'very_frequent' || v.frequency === 'frequent');
            } else {
                verbesFiltr√©s = verbes;
            }

            console.log('Verbes filtr√©s:', verbesFiltr√©s.length);

            // Afficher les informations
            let infoBullets = '';
            const countVeryFrequent = verbes.filter(v => v.frequency === 'very_frequent').length;
            const countFrequent = verbes.filter(v => v.frequency === 'frequent').length;

            if (currentFrequency === 'very_frequent') {
                infoBullets = `${countVeryFrequent} verbes charg√©s`;
            } else if (currentFrequency === 'frequent') {
                infoBullets = `${countVeryFrequent + countFrequent} verbes charg√©s`;
            } else {
                infoBullets = `${verbes.length} verbes charg√©s`;
            }

            document.getElementById('filterInfo').textContent = infoBullets;

            if (verbesFiltr√©s.length === 0) {
                document.querySelector('.exercise-box').innerHTML = 
                    `<div class="no-verbs-message">
                        <strong>Aucun verbe disponible</strong><br>
                        Aucun verbe trouv√© pour cette cat√©gorie. Veuillez choisir un autre filtre.
                    </div>`;
            } else {
                // R√©initialiser l'exercice
                correctCount = 0;
                totalCount = 0;
                questionAnswered = false;
                selectedOption = null;
                document.getElementById('validateBtn').disabled = false;
                document.getElementById('validateBtn').style.display = 'block';
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('feedback').className = 'feedback';
                document.getElementById('feedback').textContent = '';
                updateScore();
                nouvelleQuestion();
            }
        }

        function changerFiltre(frequency) {
            currentFrequency = frequency;
            
            // Mettre √† jour les boutons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            appliquerFiltre();
        }

        function nouvelleQuestion() {
            // V√©rifier si l'exercice est termin√©
            if (totalCount >= MAX_QUESTIONS) {
                afficherEcranFin();
                return;
            }

            if (verbesFiltr√©s.length === 0) return;

            questionAnswered = false;
            selectedOption = null;
            document.getElementById('validateBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('validateBtn').disabled = false;
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').textContent = '';

            // Choisir un verbe al√©atoire
            currentVerb = verbesFiltr√©s[Math.floor(Math.random() * verbesFiltr√©s.length)];

            // Choisir un type de question al√©atoire
            const typeQuestion = questionTypes[Math.floor(Math.random() * questionTypes.length)];
            currentQuestion = typeQuestion;

            // R√©cup√©rer la bonne r√©ponse
            correctAnswer = currentVerb[typeQuestion.field];

            // G√©n√©rer les options
            const options = genererOptionsAleatoires();

            // Afficher le verbe
            const auxiliaryType = getAuxiliaryType(currentVerb);
            const infinitiveDiv = document.getElementById('infinitiveForm');
            infinitiveDiv.innerHTML = `
                <span>${currentVerb.infinitive}</span>
                <button class="auxiliary-badge ${auxiliaryType}" disabled>
                    ${getAuxiliaryDisplay(auxiliaryType)}
                </button>
            `;
            document.getElementById('translation').textContent = `(${currentVerb.translation})`;
            document.getElementById('questionType').innerHTML = `<strong>Quel est le ${typeQuestion.label} ?</strong>`;

            // Afficher les options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            const auxiliaryType = getAuxiliaryType(currentVerb);
            options.forEach((option) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = translateAuxiliary(option, auxiliaryType);
                btn.onclick = () => selectionnerOption(btn, option);
                optionsContainer.appendChild(btn);
            });

            totalCount++;
            updateScore();
        }

        function genererOptionsAleatoires() {
            const correctOpt = correctAnswer;
            const allOptions = [];

            // R√©cup√©rer d'autres verbes pour les mauvaises r√©ponses
            for (let i = 0; i < verbesFiltr√©s.length && allOptions.length < 3; i++) {
                const randomVerb = verbesFiltr√©s[Math.floor(Math.random() * verbesFiltr√©s.length)];
                const randomField = currentQuestion.field;
                const option = randomVerb[randomField];
                
                if (option !== correctOpt && !allOptions.includes(option)) {
                    allOptions.push(option);
                }
            }

            // Si on n'a pas assez d'options, on en fabrique
            while (allOptions.length < 3) {
                allOptions.push(`Option ${allOptions.length + 1}`);
            }

            // M√©langer et ajouter la bonne r√©ponse
            allOptions.push(correctOpt);
            return allOptions.sort(() => Math.random() - 0.5);
        }

        function selectionnerOption(btn, option) {
            if (questionAnswered) return;

            // D√©s√©lectionner l'option pr√©c√©dente
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            
            // S√©lectionner la nouvelle option
            btn.classList.add('selected');
            selectedOption = option;
            document.getElementById('validateBtn').disabled = false;
        }

        function validerReponse() {
            if (!selectedOption || questionAnswered) return;

            questionAnswered = true;
            const isCorrect = selectedOption === correctAnswer;
            const auxiliaryType = getAuxiliaryType(currentVerb);
            const correctAnswerDisplay = translateAuxiliary(correctAnswer, auxiliaryType);
            const selectedOptionDisplay = translateAuxiliary(selectedOption, auxiliaryType);

            if (isCorrect) {
                correctCount++;
                document.getElementById('feedback').className = 'feedback correct';
                document.getElementById('feedback').innerHTML = 
                    `‚úÖ <strong>Correct !</strong> Le ${currentQuestion.label} de <strong>${currentVerb.infinitive}</strong> est bien <strong>${correctAnswerDisplay}</strong>.`;
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === correctAnswerDisplay) {
                        btn.classList.add('correct');
                    }
                });
            } else {
                document.getElementById('feedback').className = 'feedback incorrect';
                document.getElementById('feedback').innerHTML = 
                    `‚ùå <strong>Incorrect !</strong> La bonne r√©ponse est <strong>${correctAnswerDisplay}</strong>.`;
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === correctAnswerDisplay) {
                        btn.classList.add('correct');
                    } else if (btn.textContent === selectedOptionDisplay) {
                        btn.classList.add('incorrect');
                    }
                });
            }

            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            updateScore();
        }

        function updateScore() {
            document.getElementById('scoreValue').textContent = correctCount;
            document.getElementById('totalValue').textContent = totalCount;
            document.getElementById('correctCount').textContent = correctCount;
            
            if (totalCount > 0) {
                const percentage = Math.round((correctCount / totalCount) * 100);
                document.getElementById('percentage').textContent = percentage + '%';
            }
        }

        function afficherEcranFin() {
            const percentage = Math.round((correctCount / MAX_QUESTIONS) * 100);
            let message = '';
            let emoji = 'üòä';
            
            if (percentage === 100) {
                message = 'Parfait ! üåü Vous ma√Ætrisez ces verbes irr√©guliers !';
                emoji = 'üåü';
            } else if (percentage >= 80) {
                message = 'Tr√®s bien ! üëè Continuez comme √ßa !';
                emoji = 'üëè';
            } else if (percentage >= 60) {
                message = 'Bien ! üëç Vous progressez !';
                emoji = 'üëç';
            } else {
                message = '√Ä revoir ! üìö R√©essayez pour vous am√©liorer !';
                emoji = 'üìö';
            }

            const exerciseBox = document.querySelector('.exercise-box');
            exerciseBox.innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">${emoji}</div>
                    <h2 style="color: var(--primary); font-size: 1.8em; margin-bottom: 15px;">Exercice termin√© !</h2>
                    <p style="font-size: 1.2em; margin-bottom: 30px;">${message}</p>
                    
                    <div class="stats" style="margin: 30px 0;">
                        <div class="stat-box">
                            <div class="stat-label">Score final</div>
                            <div class="stat-value">${correctCount}/${MAX_QUESTIONS}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Pourcentage</div>
                            <div class="stat-value">${percentage}%</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 30px; padding: 15px 30px; font-size: 1.1em;">
                        üîÑ Recommencer
                    </button>
                </div>
            `;

            document.querySelector('.score').style.display = 'none';
        }

        // Initialisation
        window.addEventListener('load', () => {
            chargerVerbes();
        });
    </script>
</body>
</html>
